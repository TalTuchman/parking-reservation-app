<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
  <meta charset="UTF-8">
  <title>{% if lang == 'en' %}Parking Spot Reservation{% else %}Κράτηση Θέσης Στάθμευσης{% endif %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-blue-50 text-gray-800 p-4">
  <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md">
    <!-- Header -->
    <div class="flex justify-between items-center">
      <h1 class="text-2xl font-bold text-blue-700">
        {% if lang == 'en' %}Parking Spot Reservation{% else %}Κράτηση Θέσης Στάθμευσης{% endif %}
      </h1>
      <div class="text-sm">
        <a href="/lang/el" class="text-blue-600 underline mr-2">GR</a>
        <a href="/lang/en" class="text-blue-600 underline">EN</a>
      </div>
    </div>

    <!-- Lot image -->
    <div class="mt-4">
      <img src="{{ url_for('static', filename='lot2.png') }}" alt="Parking Layout" class="w-full rounded border">
    </div>

    <!-- Reservation Form -->
    <form method="POST" action="/" class="mt-6 space-y-4">

      <!-- Motorcycle Size -->
      <div>
        <label class="block mb-1 font-semibold">
          {% if lang == 'en' %}Motorcycle Size{% else %}Μέγεθος Μοτοσυκλέτας{% endif %}
        </label>
        <select id="size" name="size" class="w-full border rounded p-2" onchange="updateSpots(); updatePrice();" required>
          <option value="small">{% if lang == 'en' %}Below 400 cc{% else %}Κάτω από 400 cc{% endif %}</option>
          <option value="medium">400 cc – 1000 cc</option>
          <option value="large">{% if lang == 'en' %}Above 1000 cc{% else %}Πάνω από 1000 cc{% endif %}</option>
        </select>
      </div>

      <!-- Desired Spot -->
      <div>
        <label class="block mb-1 font-semibold">
          {% if lang == 'en' %}Desired Spot{% else %}Θέση{% endif %}
        </label>
        <select id="spot" name="spot" class="w-full border rounded p-2" required></select>
      </div>

      <!-- Subscription -->
      <div>
        <label class="block mb-1 font-semibold">
          {% if lang == 'en' %}Subscription{% else %}Συνδρομή{% endif %}
        </label>
        <select id="duration" name="duration" class="w-full border rounded p-2" onchange="updatePrice();" required>
          <option value="monthly">{% if lang == 'en' %}Monthly{% else %}Μηνιαία{% endif %}</option>
          <option value="yearly">{% if lang == 'en' %}Yearly (10 % discount){% else %}Ετήσια (10 % έκπτωση){% endif %}</option>
        </select>
      </div>

      <!-- Name -->
      <div>
        <label class="block mb-1 font-semibold">
          {% if lang == 'en' %}Name{% else %}Όνομα{% endif %}
        </label>
        <input type="text" name="name" required class="w-full border rounded p-2">
      </div>

      <!-- Phone -->
      <div>
        <label class="block mb-1 font-semibold">
          {% if lang == 'en' %}Phone{% else %}Τηλέφωνο{% endif %}
        </label>
        <input type="text" name="phone" required class="w-full border rounded p-2">
      </div>

      <!-- License Plate -->
      <div>
        <label class="block mb-1 font-semibold">
          {% if lang == 'en' %}License Plate{% else %}Αρ. Κυκλοφορίας{% endif %}
        </label>
        <input type="text" name="plate" required class="w-full border rounded p-2">
      </div>

      <!-- Price preview -->
      <p id="price" class="font-semibold text-blue-600 text-lg"></p>

      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">
        {% if lang == 'en' %}Confirm & Pay{% else %}Υποβολή & Πληρωμή{% endif %}
      </button>
    </form>
  </div>

  <script>
    // Spot pools by size tier
    const spotOptions = {
      small: ["S1","S2","S3","S4"],
      medium:["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","M13","M14","M15","M16","M17","M18","M19"],
      large: ["B1","B2","B3","B4","B5","B6","B7","B8","B9","B10","B11","B12","B13","B14","B15","B16","B17","B18","B19","B20","B21","B22","B23"]
    };
    // From backend: list of already-taken spot IDs
    const unavailableSpots = {{ unavailable_spots | tojson }};

    // Update spot dropdown based on size and availability
    function updateSpots() {
      const size   = document.getElementById('size').value;
      let choices  = spotOptions[size].filter(s => !unavailableSpots.includes(s));

      // Fallback to higher tier if none available
      if (choices.length === 0 && size === 'small')
        choices = spotOptions.medium.filter(s => !unavailableSpots.includes(s));
      if (choices.length === 0 && size === 'medium')
        choices = spotOptions.large.filter(s => !unavailableSpots.includes(s));

      const spotSel = document.getElementById('spot');
      spotSel.innerHTML = '';
      choices.forEach(id => {
        const opt = document.createElement('option');
        opt.value = id;
        opt.textContent = id;
        spotSel.appendChild(opt);
      });
    }

    // Calculate and show price preview
    function updatePrice() {
      const size      = document.getElementById('size').value;
      const duration  = document.getElementById('duration').value;
      let price = 0;
      if (size === 'small')   price = duration === 'monthly' ? 35 : 378;
      if (size === 'medium')  price = duration === 'monthly' ? 45 : 486;
      if (size === 'large')   price = duration === 'monthly' ? 50 : 540;
      document.getElementById('price').textContent =
        `Τελική τιμή / Final Price: €${price}`;
    }

    window.addEventListener('DOMContentLoaded', () => {
      updateSpots();
      updatePrice();
    });
  </script>
</body>
</html>
